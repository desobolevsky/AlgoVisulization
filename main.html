<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sorting</title>

    <script src="node_modules/jquery/dist/jquery.min.js"></script>
    <script src="node_modules/chart.js/dist/chart.js"></script>
</head>
<body>
<div class="slidecontainer">
    <label>Time Delta</label>
    <input type="range" min="1" max="500" value="50" id="sleepTimeRange" autocomplete="off" onchange="updateTime(this.value)">
</div>
<div class="slidecontainer">
    <label>Numbers amount</label>
    <input type="range" min="2" max="50" value="20" id="numberElementsRange" autocomplete="off" onchange="updateNumbersArray(this.value)">
</div>
<button id="startButton" onclick="clickHandler()">Sort</button>
<canvas id="main_chart"></canvas>
<script>
    const canvas = document.getElementById('main_chart').getContext('2d');
    const elementNumberSlider = document.getElementById('numberElementsRange')
    const startButton = document.getElementById('startButton')
    const defaultColor = 'rgb(135,135,135)';
    const iteratedColor = 'rgb(255, 0, 0)'
    let currentArrayLength = 20;
    let currentSleepTime = 50;

    let numbersArray = generateRandomArray(currentArrayLength);

    let chart = new Chart(canvas, {
        type: 'bar',
        data: {
            labels: numbersArray,
            datasets: [{
                data: numbersArray,
                backgroundColor: Array.from({length: currentArrayLength}, () => defaultColor)
            }]
        },
        options: {
            animation: false,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    async function bubbleSort(array, colors){
        switchInterfaceState(false)
        for (i = 0; i < array.length - 1; ++i){
            for (j = 0; j < array.length - i - 1; ++j){
                colors[j] = iteratedColor;
                chart.update();
                await sleep(currentSleepTime)
                if (array[j] > array[j + 1]){
                    colors[j + 1] = iteratedColor;
                    chart.update();
                    await sleep(currentSleepTime);
                    let temp = array[j + 1];
                    array[j + 1] = array[j];
                    array[j] = temp;
                }
                colors[j] = defaultColor;
                colors[j + 1] = iteratedColor;
                chart.update();
            }
        }
        colors[0] = iteratedColor;
        chart.update();
        switchInterfaceState(true)
        return array;
    }

    function updateTime(slideValue) {
        currentSleepTime = slideValue;
    }

    function updateNumbersArray(slideValue) {
        currentArrayLength = parseInt(slideValue);
        numbersArray = generateRandomArray(currentArrayLength);
        chart.data.datasets[0].data = numbersArray;
        chart.data.datasets[0].backgroundColor = Array.from({length: currentArrayLength}, () => defaultColor);
        chart.data.labels = numbersArray;
        chart.update();
    }

    function switchInterfaceState(isEnabled){
        elementNumberSlider.disabled = !isEnabled;
        startButton.disabled = !isEnabled;
    }

    function clickHandler(){
        numbersArray = bubbleSort(numbersArray, chart.data.datasets[0].backgroundColor);
        chart.update()
    }

    function generateRandomArray(arrayLength){
        return Array.from({length: arrayLength}, () => Math.floor(Math.random() * 50) + 1);
    }
</script>

</body>
</html>